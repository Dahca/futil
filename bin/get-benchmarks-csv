#!/bin/bash

set -eu

cleanup() {
    rm -r $tmp
}
trap cleanup EXIT

benchmarks=./benchmarks/*.fuse

echo "benchmark,latency"
tmp="$(mktemp -d)"
for bench in $benchmarks; do
  base="$(basename -s .fuse $bench)"

  ./bin/find-dahlia "$bench" -l error -b futil --lower > "$tmp/$base.futil"
  ./bin/run-benchmark "$tmp/$base.futil" ./benchmarks/data/"$base".data | head -n 1
done
